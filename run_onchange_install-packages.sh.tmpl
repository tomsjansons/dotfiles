#!/bin/bash

if ! command -v yay &> /dev/null; then
	cd /tmp && sudo pacman -S --needed git base-devel && git clone https://aur.archlinux.org/yay.git && cd yay && makepkg -si --noconfirm
fi

{{ if eq .chezmoi.osRelease.id "arch" }}

{{ range .packages.arch.pacman }}
sudo pacman -S --noconfirm --needed {{ . | quote }}
{{ end -}}

{{ range .packages.arch.yay }}
yay -S --noconfirm --needed {{ . | quote }}
{{ end -}}

{{ range .packages.cargo }}
cargo install {{ . | quote }}
{{ end -}}

mise use -g node@22

if [ $SHELL != '/usr/bin/zsh' ]; then
	sudo chsh --shell /usr/bin/zsh toms
fi

if ! groups | grep -q 'video'; then
	echo "Adding video to user groups"
	sudo usermod -aG video toms
fi

sudo systemctl enable greetd.service

{{ end -}}
